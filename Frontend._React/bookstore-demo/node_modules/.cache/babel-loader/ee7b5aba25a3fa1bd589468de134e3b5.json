{"ast":null,"code":"var _jsxFileName = \"D:\\\\RS2\\\\bookstore-demo\\\\src\\\\context\\\\auth.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport React from \"react\";\nimport Shared from \"../utils/shared\";\nimport { RoutePaths } from \"../utils/enum\";\nimport UserModel from \"../models/UserModel\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  setUser: () => {},\n  user: new UserModel(),\n  signOut: () => {},\n  appInitialize: false\n};\nexport const AuthContext = /*#__PURE__*/createContext(initialState);\nexport const AuthWrapper = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [appInitialize, setAppInitialize] = useState(false);\n  const [user, _setUser] = useState(new UserModel());\n  const history = useHistory();\n  const {\n    pathname\n  } = useLocation();\n\n  const setUser = user => {\n    localStorage.setItem(Shared.LocalStorageKeys.USER, JSON.stringify(user));\n\n    _setUser(user);\n  }; // useEffect(() => {\n  //   const token = localStorage.getItem(Shared.LocalStorageKeys.USER);\n  //   if (user.id && !token) {\n  //     signOut();\n  //   }\n  // }, [localStorage.getItem(Shared.LocalStorageKeys.USER)]);\n\n\n  useEffect(() => {\n    const itemStr = JSON.parse(localStorage.getItem(Shared.LocalStorageKeys.USER)) || new UserModel(); // if the item doesn't exist, return null\n\n    if (!itemStr.id) {\n      history.push(`${RoutePaths.Login}`);\n    }\n\n    _setUser(itemStr);\n  }, []);\n\n  const signOut = () => {\n    setUser(new UserModel());\n    localStorage.removeItem(Shared.LocalStorageKeys.USER);\n    history.push(`..${RoutePaths.Login}`);\n  };\n\n  useEffect(() => {\n    if (pathname === RoutePaths.Login && user.id) {\n      history.push(RoutePaths.BookListing);\n    }\n\n    if (!user.id) {\n      return;\n    }\n\n    const access = Shared.hasAccess(pathname, user);\n\n    if (!access) {\n      toast.warning(\"Sorry, you are not authorized to access this page\");\n      history.push(RoutePaths.BookListing);\n      return;\n    }\n\n    setAppInitialize(true); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pathname, user]);\n  let value = {\n    user,\n    setUser,\n    signOut,\n    appInitialize\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AuthWrapper, \"ftl7nMClaHXwXizD1H9ulzZFaKI=\", false, function () {\n  return [useHistory, useLocation];\n});\n\n_c = AuthWrapper;\nexport const useAuthContext = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuthContext, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthWrapper\");","map":{"version":3,"names":["createContext","useContext","useEffect","useState","React","Shared","RoutePaths","UserModel","useHistory","useLocation","toast","initialState","setUser","user","signOut","appInitialize","AuthContext","AuthWrapper","children","setAppInitialize","_setUser","history","pathname","localStorage","setItem","LocalStorageKeys","USER","JSON","stringify","itemStr","parse","getItem","id","push","Login","removeItem","BookListing","access","hasAccess","warning","value","useAuthContext"],"sources":["D:/RS2/bookstore-demo/src/context/auth.tsx"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\r\nimport React from \"react\";\r\nimport Shared from \"../utils/shared\";\r\nimport { RoutePaths } from \"../utils/enum\";\r\nimport UserModel from \"../models/UserModel\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport interface AuthContextModel {\r\n\tsetUser: (user: UserModel) => void;\r\n\tuser: UserModel;\r\n\tsignOut: () => void;\r\n\tappInitialize: boolean;\r\n}\r\n\r\nconst initialState: AuthContextModel = {\r\n\tsetUser: () => {},\r\n\tuser: new UserModel(),\r\n\tsignOut: () => {},\r\n\tappInitialize: false,\r\n};\r\n\r\nexport const AuthContext = createContext(initialState);\r\n\r\nexport const AuthWrapper: React.FC<React.PropsWithChildren<{}>> = ({\r\n\tchildren,\r\n}: React.PropsWithChildren<{}>) => {\r\n\tconst [appInitialize, setAppInitialize] = useState<boolean>(false);\r\n\tconst [user, _setUser] = useState<UserModel>(new UserModel());\r\n\r\n\tconst history = useHistory();\r\n\tconst { pathname } = useLocation();\r\n\r\n\tconst setUser = (user: UserModel): void => {\r\n\t\tlocalStorage.setItem(Shared.LocalStorageKeys.USER, JSON.stringify(user));\r\n\t\t_setUser(user);\r\n\t};\r\n\r\n\t// useEffect(() => {\r\n\t//   const token = localStorage.getItem(Shared.LocalStorageKeys.USER);\r\n\t//   if (user.id && !token) {\r\n\t//     signOut();\r\n\t//   }\r\n\t// }, [localStorage.getItem(Shared.LocalStorageKeys.USER)]);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst itemStr: UserModel =\r\n\t\t\t(JSON.parse(\r\n\t\t\t\tlocalStorage.getItem(Shared.LocalStorageKeys.USER) as string\r\n\t\t\t) as UserModel) || new UserModel();\r\n\t\t// if the item doesn't exist, return null\r\n\t\tif (!itemStr.id) {\r\n\t\t\thistory.push(`${RoutePaths.Login}`);\r\n\t\t}\r\n\t\t_setUser(itemStr);\r\n\t}, []);\r\n\r\n\tconst signOut = (): void => {\r\n\t\tsetUser(new UserModel());\r\n\t\tlocalStorage.removeItem(Shared.LocalStorageKeys.USER);\r\n\t\thistory.push(`..${RoutePaths.Login}`);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (pathname === RoutePaths.Login && user.id) {\r\n\t\t\thistory.push(RoutePaths.BookListing);\r\n\t\t}\r\n\r\n\t\tif (!user.id) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst access: boolean = Shared.hasAccess(pathname, user);\r\n\t\tif (!access) {\r\n\t\t\ttoast.warning(\"Sorry, you are not authorized to access this page\");\r\n\t\t\thistory.push(RoutePaths.BookListing);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetAppInitialize(true);\r\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\r\n\t}, [pathname, user]);\r\n\r\n\tlet value: AuthContextModel = {\r\n\t\tuser,\r\n\t\tsetUser,\r\n\t\tsignOut,\r\n\t\tappInitialize,\r\n\t};\r\n\r\n\treturn <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n\r\nexport const useAuthContext = () => {\r\n\treturn useContext(AuthContext);\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}